<?php

namespace Huytt\User\Tests\Unit;

use Huytt\User\Repositories\UserRepository;
use Illuminate\Foundation\Testing\DatabaseTransactions;
use Illuminate\Foundation\Testing\WithFaker;
use Tests\TestCase;

class UserTest extends TestCase
{
    use DatabaseTransactions, WithFaker;

    /** @var UserRepository */
    protected $repository;

    protected $token;

    public function setUp(): void
    {
        parent::setUp(); // TODO: Change the autogenerated stub
        $this->repository = new UserRepository($this->app);
        $this->setUpFaker();
    }

    public function testRegister()
    {
        $payload = [
            "name" => $this->faker->name,
            "email" => $this->faker->email,
            "password" => $this->faker->password
        ];

        $reponse = $this
            ->json('post', 'api/v1/users/register', $payload);

//        echo json_encode($reponse)."\n";
        $reponse->assertStatus(201);
        $id = $reponse->decodeResponseJson()['data']['id'];
        $user = $this->repository->find($id);
        $this->assertEquals($payload['name'], $user->name);
        $this->assertEquals($payload['email'], $user->email);

        return array_merge($payload, ['id' => $id]);
    }
}
